"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9058],{5392:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"storage/mongodb-setup","title":"MongoDB Setup","description":"For general troubleshooting, see Troubleshooting. This guide covers MongoDB-specific network configuration issues.","source":"@site/docs/storage/mongodb-setup.md","sourceDirName":"storage","slug":"/storage/mongodb-setup","permalink":"/docs/storage/mongodb-setup","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"MongoDB Setup"},"sidebar":"tutorialSidebar","previous":{"title":"Database Schema","permalink":"/docs/storage/database-schema"},"next":{"title":"Troubleshooting","permalink":"/docs/guides/troubleshooting"}}');var r=s(4848),o=s(8453);const l={sidebar_position:2,title:"MongoDB Setup"},t="MongoDB Atlas Network Configuration - Troubleshooting Guide",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Common Issue: IP Whitelisting",id:"common-issue-ip-whitelisting",level:2},{value:"Troubleshooting Steps",id:"troubleshooting-steps",level:2},{value:"If SSL/TLS Errors Occur After Deployments",id:"if-ssltls-errors-occur-after-deployments",level:3},{value:"Cloud Platform NAT Behavior",id:"cloud-platform-nat-behavior",level:3},{value:"Emergency Fixes",id:"emergency-fixes",level:2},{value:"Quick Fix for Immediate Access",id:"quick-fix-for-immediate-access",level:3},{value:"Common Misconceptions",id:"common-misconceptions",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"For Production Deployments",id:"for-production-deployments",level:3},{value:"For Development/Testing",id:"for-developmenttesting",level:3},{value:"Security Considerations",id:"security-considerations",level:3},{value:"SSL/TLS Configuration",id:"ssltls-configuration",level:2},{value:"Docker Configuration",id:"docker-configuration",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Connection String Format",id:"connection-string-format",level:3},{value:"Kubernetes-Specific Issues",id:"kubernetes-specific-issues",level:2},{value:"Pod-to-Pod vs Pod-to-External",id:"pod-to-pod-vs-pod-to-external",level:3},{value:"Network Policies",id:"network-policies",level:3},{value:"Service Mesh Considerations",id:"service-mesh-considerations",level:3},{value:"Testing Connections",id:"testing-connections",level:2},{value:"From Local Machine",id:"from-local-machine",level:3},{value:"From Kubernetes Pod",id:"from-kubernetes-pod",level:3},{value:"Verify Egress IP",id:"verify-egress-ip",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mongodb-atlas-network-configuration---troubleshooting-guide",children:"MongoDB Atlas Network Configuration - Troubleshooting Guide"})}),"\n",(0,r.jsxs)(n.p,{children:["For general troubleshooting, see ",(0,r.jsx)(n.a,{href:"/docs/guides/troubleshooting",children:"Troubleshooting"}),". This guide covers MongoDB-specific network configuration issues."]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The SmartRunning application connects to MongoDB Atlas, a cloud-hosted database service. Network configuration, particularly IP whitelisting, is critical for successful connections from deployed applications."}),"\n",(0,r.jsx)(n.h2,{id:"common-issue-ip-whitelisting",children:"Common Issue: IP Whitelisting"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": SSL/TLS handshake errors in cloud deployments (but not local Docker)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Root Cause"}),": MongoDB Atlas IP whitelist blocking connections, NOT SSL certificate issues"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Understanding"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Load Balancer IP \u2260 Egress IP for outbound database connections"}),"\n",(0,r.jsx)(n.li,{children:"Cloud platforms use managed NAT that may change IPs between deployments"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-steps",children:"Troubleshooting Steps"}),"\n",(0,r.jsx)(n.h3,{id:"if-ssltls-errors-occur-after-deployments",children:"If SSL/TLS Errors Occur After Deployments"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check Current Egress IP"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it deployment/your-app -- \\\n  python -c \"import urllib.request; print('Current Egress IP:', urllib.request.urlopen('https://api.ipify.org').read().decode())\"\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Compare with MongoDB Atlas Whitelist"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Go to MongoDB Atlas \u2192 Network Access"}),"\n",(0,r.jsx)(n.li,{children:"Verify the current egress IP is whitelisted"}),"\n",(0,r.jsxs)(n.li,{children:["Format should be: ",(0,r.jsx)(n.code,{children:"X.X.X.X/32"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"If IP Changed, Add to Whitelist"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Add the new IP with ",(0,r.jsx)(n.code,{children:"/32"})," suffix"]}),"\n",(0,r.jsx)(n.li,{children:"Keep existing working IPs until confirmed stable"}),"\n",(0,r.jsx)(n.li,{children:"Test connection after adding"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Verify Application Logs"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl logs deployment/your-app --tail=10\n"})}),"\n",(0,r.jsx)(n.p,{children:"Look for connection success/failure messages"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cloud-platform-nat-behavior",children:"Cloud Platform NAT Behavior"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Cloud NAT"}),": May be created but not used by managed services"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Managed NAT"}),": Cloud platforms use their own NAT gateways"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"IP Stability"}),": Egress IPs can change between deployments"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),": Use static IPs or whitelist range if supported"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"emergency-fixes",children:"Emergency Fixes"}),"\n",(0,r.jsx)(n.h3,{id:"quick-fix-for-immediate-access",children:"Quick Fix for Immediate Access"}),"\n",(0,r.jsx)(n.p,{children:"If the application is down due to IP blocking:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# 1. Get current egress IP\nkubectl exec -it deployment/your-app -- \\\n  python -c \"import urllib.request; print(urllib.request.urlopen('https://api.ipify.org').read().decode())\"\n\n# 2. Add this IP to MongoDB Atlas Network Access with /32 suffix\n# 3. Test connection\nkubectl logs deployment/your-app --tail=5\n"})}),"\n",(0,r.jsx)(n.h3,{id:"common-misconceptions",children:"Common Misconceptions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Load Balancer IP is NOT used for MongoDB connections"}),"\n",(0,r.jsx)(n.li,{children:"\u274c SSL certificate issues are NOT typically the root cause"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 IP whitelist blocking is the actual problem"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Local Docker works because it uses different network routing (check via ",(0,r.jsx)(n.a,{href:"https://ipinfo.io/ip",children:"ipinfo.io"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"for-production-deployments",children:"For Production Deployments"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use Static IPs"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reserve static external IPs in your cloud provider"}),"\n",(0,r.jsx)(n.li,{children:"Configure NAT gateway to use static IPs"}),"\n",(0,r.jsx)(n.li,{children:"Whitelist these static IPs in MongoDB Atlas"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Monitor IP Changes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Set up alerts for connection failures"}),"\n",(0,r.jsx)(n.li,{children:"Log egress IP on application startup"}),"\n",(0,r.jsx)(n.li,{children:"Document current working IPs"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Maintain IP Documentation"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keep record of whitelisted IPs"}),"\n",(0,r.jsx)(n.li,{children:"Note which environment uses which IP"}),"\n",(0,r.jsx)(n.li,{children:"Update documentation when IPs change"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"for-developmenttesting",children:"For Development/Testing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Whitelist Development IPs"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add your local development machine IP"}),"\n",(0,r.jsx)(n.li,{children:"Add CI/CD pipeline IPs if applicable"}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"/32"})," suffix for single IPs"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Temporary Access"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MongoDB Atlas allows temporary whitelist entries"}),"\n",(0,r.jsx)(n.li,{children:"Set expiration times for development IPs"}),"\n",(0,r.jsx)(n.li,{children:"Remove unused IPs regularly"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Avoid ",(0,r.jsx)(n.code,{children:"0.0.0.0/0"})]}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Never whitelist all IPs in production"}),"\n",(0,r.jsx)(n.li,{children:"Use specific IPs or narrow IP ranges"}),"\n",(0,r.jsx)(n.li,{children:"Principle of least privilege"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Regular Audits"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Review whitelisted IPs monthly"}),"\n",(0,r.jsx)(n.li,{children:"Remove IPs no longer in use"}),"\n",(0,r.jsx)(n.li,{children:"Verify ownership of all IPs"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Network Segmentation"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use different MongoDB clusters for dev/staging/prod"}),"\n",(0,r.jsx)(n.li,{children:"Apply different whitelist rules per environment"}),"\n",(0,r.jsx)(n.li,{children:"Limit production access strictly"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ssltls-configuration",children:"SSL/TLS Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"docker-configuration",children:"Docker Configuration"}),"\n",(0,r.jsx)(n.p,{children:"The application Docker image includes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ca-certificates"})," package"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"openssl"})," package"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"certifi"})," Python package for SSL certificate management"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"Required SSL configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt\nREQUESTS_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt\n"})}),"\n",(0,r.jsx)(n.p,{children:"These are typically set automatically in the Dockerfile."}),"\n",(0,r.jsx)(n.h3,{id:"connection-string-format",children:"Connection String Format"}),"\n",(0,r.jsx)(n.p,{children:"MongoDB Atlas connection strings should use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mongodb+srv://username:password@cluster.mongodb.net/database?retryWrites=true&w=majority\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Security Notes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Never commit connection strings to version control"}),"\n",(0,r.jsx)(n.li,{children:"Use environment variables for credentials"}),"\n",(0,r.jsx)(n.li,{children:"Rotate passwords regularly"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"kubernetes-specific-issues",children:"Kubernetes-Specific Issues"}),"\n",(0,r.jsx)(n.h3,{id:"pod-to-pod-vs-pod-to-external",children:"Pod-to-Pod vs Pod-to-External"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Internal cluster communication uses cluster IPs"}),"\n",(0,r.jsx)(n.li,{children:"External MongoDB connections use node/NAT egress IPs"}),"\n",(0,r.jsx)(n.li,{children:"These are different IP addresses"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"network-policies",children:"Network Policies"}),"\n",(0,r.jsx)(n.p,{children:"If using Kubernetes Network Policies:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Allow egress to MongoDB Atlas IP ranges"}),"\n",(0,r.jsx)(n.li,{children:"Check if policies are blocking database connections"}),"\n",(0,r.jsx)(n.li,{children:"Verify DNS resolution is allowed"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-mesh-considerations",children:"Service Mesh Considerations"}),"\n",(0,r.jsx)(n.p,{children:"If using Istio, Linkerd, or similar:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Egress traffic may be proxied"}),"\n",(0,r.jsx)(n.li,{children:"Check service mesh egress gateway IPs"}),"\n",(0,r.jsx)(n.li,{children:"Configure MongoDB Atlas whitelist accordingly"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"testing-connections",children:"Testing Connections"}),"\n",(0,r.jsx)(n.h3,{id:"from-local-machine",children:"From Local Machine"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Test DNS resolution\nnslookup cluster.mongodb.net\n\n# Test connection with mongosh\nmongosh "mongodb+srv://cluster.mongodb.net/database"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"from-kubernetes-pod",children:"From Kubernetes Pod"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Test from running pod\nkubectl exec -it deployment/your-app -- \\\n  python -c \"from pymongo import MongoClient; \\\n  client = MongoClient('mongodb+srv://...'); \\\n  print('Connected:', client.server_info())\"\n"})}),"\n",(0,r.jsx)(n.h3,{id:"verify-egress-ip",children:"Verify Egress IP"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check what IP MongoDB Atlas sees\nkubectl exec -it deployment/your-app -- \\\n  curl https://api.ipify.org\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/guides/troubleshooting",children:"Troubleshooting"})," - General troubleshooting guide"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/storage/database-schema",children:"Database Schema"})," - MongoDB collection structures"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/architecture/deployment",children:"Deployment"})," - Deployment architecture details"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Document Version:"})," 2.0 (Public - Sanitized)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," This document provides general guidance for MongoDB Atlas network configuration. Specific cluster addresses, IP addresses, and connection strings have been redacted for security."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(6540);const r={},o=i.createContext(r);function l(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);