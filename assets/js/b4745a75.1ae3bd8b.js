"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3402],{8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var i=s(6540);const r={},l=i.createContext(r);function c(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(l.Provider,{value:n},e.children)}},9685:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"architecture/components","title":"Components","description":"0. Configuration Layer (config.py)","source":"@site/docs/architecture/components.md","sourceDirName":"architecture","slug":"/architecture/components","permalink":"/docs/architecture/components","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/architecture/components.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Components"},"sidebar":"tutorialSidebar","previous":{"title":"System Overview","permalink":"/docs/architecture/overview"},"next":{"title":"Data Flow","permalink":"/docs/architecture/data-flow"}}');var r=s(4848),l=s(8453);const c={sidebar_position:2,title:"Components"},a="Components",t={},o=[{value:"0. Configuration Layer (<code>config.py</code>)",id:"0-configuration-layer-configpy",level:2},{value:"1. Web Layer (Flask Application)",id:"1-web-layer-flask-application",level:2},{value:"2. Service Layer",id:"2-service-layer",level:2},{value:"File Processor (<code>file_processor.py</code>)",id:"file-processor-file_processorpy",level:3},{value:"Statistics Processor (<code>statistics_processor.py</code>)",id:"statistics-processor-statistics_processorpy",level:3},{value:"Runner History Processor (<code>runner_history_processor.py</code>)",id:"runner-history-processor-runner_history_processorpy",level:3},{value:"Training Plan Generator (<code>training_plan_generator.py</code>)",id:"training-plan-generator-training_plan_generatorpy",level:3},{value:"Job Manager (<code>job_manager.py</code>)",id:"job-manager-job_managerpy",level:3},{value:"Critical Speed Calculator (<code>critical_speed.py</code>)",id:"critical-speed-calculator-critical_speedpy",level:3},{value:"Heart Rate Calculator (<code>heart_rate_calculator.py</code>)",id:"heart-rate-calculator-heart_rate_calculatorpy",level:3},{value:"Runner Service (<code>services/runner_service.py</code>)",id:"runner-service-servicesrunner_servicepy",level:3},{value:"3. Data Access Layer",id:"3-data-access-layer",level:2},{value:"4. External Integration Layer",id:"4-external-integration-layer",level:2},{value:"Garmin FIT SDK (<code>garmin_fit_sdk/</code>)",id:"garmin-fit-sdk-garmin_fit_sdk",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"components",children:"Components"})}),"\n",(0,r.jsxs)(n.h2,{id:"0-configuration-layer-configpy",children:["0. Configuration Layer (",(0,r.jsx)(n.code,{children:"config.py"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Centralized configuration management for the entire application"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Single point of configuration for MongoDB connection details"}),"\n",(0,r.jsxs)(n.li,{children:["Environment variable support with ",(0,r.jsx)(n.code,{children:".env"})," file integration"]}),"\n",(0,r.jsx)(n.li,{children:"Application settings (file size limits, validation thresholds)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For configuration details, see ",(0,r.jsx)(n.a,{href:"/docs/overview",children:"Platform Overview"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"1-web-layer-flask-application",children:"1. Web Layer (Flask Application)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Handle HTTP requests, routing, and response formatting"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Components"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"app.py"})," - Application entry point"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"app/__init__.py"})," - Flask application factory"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"app/routes.py"})," - RESTful API endpoints"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Responsibilities"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request validation"}),"\n",(0,r.jsx)(n.li,{children:"Response serialization"}),"\n",(0,r.jsx)(n.li,{children:"Session management"}),"\n",(0,r.jsx)(n.li,{children:"CORS handling"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-service-layer",children:"2. Service Layer"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Business logic and data processing"]}),"\n",(0,r.jsxs)(n.h3,{id:"file-processor-file_processorpy",children:["File Processor (",(0,r.jsx)(n.code,{children:"file_processor.py"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Handles FIT file parsing using Garmin SDK"}),"\n",(0,r.jsx)(n.li,{children:"Manages ZIP file extraction"}),"\n",(0,r.jsx)(n.li,{children:"Implements duplicate detection"}),"\n",(0,r.jsx)(n.li,{children:"Stores raw data in GridFS"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"statistics-processor-statistics_processorpy",children:["Statistics Processor (",(0,r.jsx)(n.code,{children:"statistics_processor.py"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Calculates session metrics (pace, heart rate, power)"}),"\n",(0,r.jsx)(n.li,{children:"Computes training zones using Critical Speed"}),"\n",(0,r.jsx)(n.li,{children:"Tracks personal bests"}),"\n",(0,r.jsx)(n.li,{children:"Generates efficiency metrics including rTSS based on Critical Speed"}),"\n",(0,r.jsx)(n.li,{children:"Automatically triggers Critical Speed recalculation when PBs improve"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"runner-history-processor-runner_history_processorpy",children:["Runner History Processor (",(0,r.jsx)(n.code,{children:"runner_history_processor.py"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Calculates CTL (Chronic Training Load)"}),"\n",(0,r.jsx)(n.li,{children:"Calculates ATL (Acute Training Load)"}),"\n",(0,r.jsx)(n.li,{children:"Calculates TSB (Training Stress Balance)"}),"\n",(0,r.jsx)(n.li,{children:"Implements Banister model calculations"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"training-plan-generator-training_plan_generatorpy",children:["Training Plan Generator (",(0,r.jsx)(n.code,{children:"training_plan_generator.py"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates periodized training plans"}),"\n",(0,r.jsx)(n.li,{children:"Assigns workouts to training blocks"}),"\n",(0,r.jsx)(n.li,{children:"Calculates progressive overload"}),"\n",(0,r.jsx)(n.li,{children:"Manages tapering periods"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"job-manager-job_managerpy",children:["Job Manager (",(0,r.jsx)(n.code,{children:"job_manager.py"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Manages all asynchronous background processing to prevent UI blocking and database contention."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Thread-based execution"}),": Spawns daemon threads for background jobs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Job tracking"}),": Stores job status in ",(0,r.jsx)(n.code,{children:"background_jobs"})," collection"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Progress updates"}),": Updates job progress percentage in real-time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automatic chaining"}),": File processing jobs automatically queue analysis jobs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Error handling"}),": Graceful failure handling with error logging"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Job Types"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"file_processing"}),": Unzip, validate, convert FIT\u2192Parquet, store in GridFS"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"session_analysis"}),": Calculate statistics, update PBs, recalculate critical speed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"training_plan_generation"}),": Generate personalized training plans"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Job Status Flow"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pending \u2192 running \u2192 completed\n                 \u2192 failed\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implementation Details"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'No polling from frontend (eliminates database "busy" errors)'}),"\n",(0,r.jsxs)(n.li,{children:["Jobs tracked in ",(0,r.jsx)(n.code,{children:"background_jobs"})," collection with timestamps"]}),"\n",(0,r.jsx)(n.li,{children:"Progress updates: 0% (created) \u2192 100% (completed/failed)"}),"\n",(0,r.jsx)(n.li,{children:"Old jobs cleaned up after 7 days"}),"\n",(0,r.jsx)(n.li,{children:"Results stored in job document for retrieval"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"critical-speed-calculator-critical_speedpy",children:["Critical Speed Calculator (",(0,r.jsx)(n.code,{children:"critical_speed.py"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Calculates Critical Speed (CS) using linear regression model"}),"\n",(0,r.jsx)(n.li,{children:"Implements D = W' + CS * T relationship"}),"\n",(0,r.jsx)(n.li,{children:"Validates personal best times for consistency"}),"\n",(0,r.jsx)(n.li,{children:"Returns CS (m/s), W' (anaerobic capacity in meters), and R\xb2 value"}),"\n",(0,r.jsx)(n.li,{children:"Uses scikit-learn for regression analysis"}),"\n",(0,r.jsx)(n.li,{children:"Automatically triggered during session analysis when PBs are updated"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"heart-rate-calculator-heart_rate_calculatorpy",children:["Heart Rate Calculator (",(0,r.jsx)(n.code,{children:"heart_rate_calculator.py"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Calculates maximum heart rate using HUNT formula: Max HR = 211 - (0.64 \xd7 age)"}),"\n",(0,r.jsx)(n.li,{children:"Automatically calculates five training zones based on configurable percentages"}),"\n",(0,r.jsx)(n.li,{children:"Zone 1 (Recovery): 60% of max HR"}),"\n",(0,r.jsx)(n.li,{children:"Zone 2 (Endurance): 70% of max HR"}),"\n",(0,r.jsx)(n.li,{children:"Zone 3 (Tempo): 80% of max HR"}),"\n",(0,r.jsx)(n.li,{children:"Zone 4 (Threshold): 90% of max HR"}),"\n",(0,r.jsx)(n.li,{children:"Zone 5 (VO2 Max): 100% of max HR"}),"\n",(0,r.jsx)(n.li,{children:"Provides validation functions for heart rate zone consistency"}),"\n",(0,r.jsx)(n.li,{children:"Integrates with frontend for automatic calculation during runner registration"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"runner-service-servicesrunner_servicepy",children:["Runner Service (",(0,r.jsx)(n.code,{children:"services/runner_service.py"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Ensures consistent runner creation across all application entry points"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Centralized default values"}),": All runners receive complete defaults from ",(0,r.jsx)(n.code,{children:"defaults.py"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multiple creation paths unified"}),": Coaches, admins, and user registration use same logic"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consistent data integrity"}),": PBs, Banister parameters, and zones always present"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Core Functions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"create_runner_with_defaults()"})," - Creates new runner with full default template"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"create_minimal_runner_for_user()"})," - Creates runner during user registration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"update_runner_with_defaults()"})," - Updates runner while preserving defaults"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ensure_runner_has_defaults()"})," - Backfills missing defaults for existing runners"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Default Values Applied"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Personal Bests: Default times for multiple distances"}),"\n",(0,r.jsx)(n.li,{children:"Physiological Model: Model-specific parameters"}),"\n",(0,r.jsx)(n.li,{children:"Training Load: Default training load ranges"}),"\n",(0,r.jsx)(n.li,{children:"Heart Rate Zones: Age-based defaults for 5 zones"}),"\n",(0,r.jsx)(n.li,{children:"Training Schedule: 4 blocks, 4 weeks/block, 2 taper weeks"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"3-data-access-layer",children:"3. Data Access Layer"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Database operations and data persistence"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Components"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"database.py"})," - ",(0,r.jsx)(n.strong,{children:"Centralized MongoDB connection manager (Singleton)"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config.py"})," - ",(0,r.jsx)(n.strong,{children:"Centralized configuration management"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"models.py"})," - Data model definitions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"defaults.py"})," - Default configuration values"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Database Connection Architecture"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single Point of Configuration"}),": All MongoDB connections managed through ",(0,r.jsx)(n.code,{children:"Config"})," class"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Singleton Pattern"}),": ",(0,r.jsx)(n.code,{children:"Database"})," class provides application-wide connection sharing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment-Based"}),": Connection details configurable via ",(0,r.jsx)(n.code,{children:".env"})," file"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GridFS Integration"}),": File storage centrally managed through singleton"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Collections Structure"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"The database uses 11 MongoDB collections:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"runner"})," - Athlete profiles with physiological parameters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"sessionsFIT"})," / ",(0,r.jsx)(n.strong,{children:"sessionsParquet"})," - Raw and processed session data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"sessionStatistics"})," - Aggregated session metrics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"runnerHistory"})," - Daily training load progression metrics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"trainingplan"})," / ",(0,r.jsx)(n.strong,{children:"trainingplanschema"})," - Training plans (flat and nested)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"workouts"})," - Workout library"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"background_jobs"})," - Async job tracking"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fs.files"})," / ",(0,r.jsx)(n.strong,{children:"fs.chunks"})," - GridFS binary file storage"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For complete schema documentation, see ",(0,r.jsx)(n.a,{href:"/docs/storage/database-schema",children:"Database Schema"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"4-external-integration-layer",children:"4. External Integration Layer"}),"\n",(0,r.jsxs)(n.h3,{id:"garmin-fit-sdk-garmin_fit_sdk",children:["Garmin FIT SDK (",(0,r.jsx)(n.code,{children:"garmin_fit_sdk/"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Custom implementation for FIT file parsing"}),"\n",(0,r.jsx)(n.li,{children:"Handles various FIT message types"}),"\n",(0,r.jsx)(n.li,{children:"Provides data validation and error handling"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Components"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"decoder.py"})," - Main decoding logic"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"profile.py"})," - FIT profile definitions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stream.py"})," - Byte stream handling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bitstream.py"})," - Bit-level operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"crc_calculator.py"})," - Checksum validation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);