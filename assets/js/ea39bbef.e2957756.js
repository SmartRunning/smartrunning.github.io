"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7340],{2790:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"architecture/time-series","title":"Time Series","description":"Overview","source":"@site/docs/architecture/time-series.md","sourceDirName":"architecture","slug":"/architecture/time-series","permalink":"/docs/architecture/time-series","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/architecture/time-series.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Time Series"},"sidebar":"tutorialSidebar","previous":{"title":"Deployment","permalink":"/docs/architecture/deployment"},"next":{"title":"Operations","permalink":"/docs/architecture/operations"}}');var t=i(4848),r=i(8453);const d={sidebar_position:6,title:"Time Series"},c="Time Series",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Data Structure",id:"data-structure",level:2},{value:"Sequential Processing Workflow",id:"sequential-processing-workflow",level:2},{value:"1. File Upload &amp; Sorting",id:"1-file-upload--sorting",level:3},{value:"2. Session Processing with Time Series",id:"2-session-processing-with-time-series",level:3},{value:"3. Automatic PB Detection &amp; Updates",id:"3-automatic-pb-detection--updates",level:3},{value:"4. Critical Speed Recalculation",id:"4-critical-speed-recalculation",level:3},{value:"5. Historical Upload Cascade",id:"5-historical-upload-cascade",level:3},{value:"Key Components",id:"key-components",level:2},{value:"Time Series Utility Functions",id:"time-series-utility-functions",level:2},{value:"REST API Endpoints",id:"rest-api-endpoints",level:2},{value:"Benefits Achieved",id:"benefits-achieved",level:2},{value:"Migration",id:"migration",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"time-series",children:"Time Series"})}),"\n",(0,t.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(s.p,{children:"The application implements a time series system for tracking runner performance metrics over time. This architecture enables historical data preservation, period-appropriate calculations, and automatic performance metric updates."}),"\n",(0,t.jsx)(s.h2,{id:"data-structure",children:"Data Structure"}),"\n",(0,t.jsxs)(s.p,{children:["All time series data follows a consistent structure (see ",(0,t.jsx)(s.a,{href:"/docs/storage/database-schema",children:"Database Schema"}),"):"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-javascript",children:'{\n  "timestamp": ISODate("2025-01-15T00:00:00.000Z"),\n  "value": { /* metric-specific data */ },\n  "source": "session_upload",  // How the value was obtained\n  "notes": "Optional description"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Applied to:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Heart Rate Zones"})," (",(0,t.jsx)(s.code,{children:"heart_rate_zones_history"}),") - Training zone evolution"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Personal Bests"})," (",(0,t.jsx)(s.code,{children:"pb_history"}),") - Best times across multiple distances"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Performance Metrics"})," (",(0,t.jsx)(s.code,{children:"performance_metrics_time_series"}),") - Fitness marker progression"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"sequential-processing-workflow",children:"Sequential Processing Workflow"}),"\n",(0,t.jsx)(s.h3,{id:"1-file-upload--sorting",children:"1. File Upload & Sorting"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"User uploads FIT files (single or ZIP)\n        \u2193\nExtract all FIT files from ZIP archives\n        \u2193\nExtract session dates from each FIT file\n        \u2193\nSort files chronologically (oldest first)\n        \u2193\nProcess sequentially\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Implementation:"})," ",(0,t.jsx)(s.code,{children:"app/file_processor.py:process_uploaded_files()"})]}),"\n",(0,t.jsx)(s.h3,{id:"2-session-processing-with-time-series",children:"2. Session Processing with Time Series"}),"\n",(0,t.jsx)(s.p,{children:"For each session (oldest to newest):"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"1. Get session date from FIT file\n        \u2193\n2. Query time series for values at that date\n   - Heart rate zones active at session date\n   - Personal bests current at session date\n   - Critical speed valid at session date\n        \u2193\n3. Calculate statistics using period-appropriate values\n        \u2193\n4. Detect if any personal bests were achieved\n        \u2193\n5. If PB detected \u2192 Update PB time series\n        \u2193\n6. If PB updated \u2192 Recalculate critical speed\n        \u2193\n7. Move to next session (repeat)\n"})}),"\n",(0,t.jsx)(s.h3,{id:"3-automatic-pb-detection--updates",children:"3. Automatic PB Detection & Updates"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Detection Logic:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"# For each tracked distance in session\ncurrent_pb = get_value_at_date(pb_history, session_date)\nsession_time = extract_segment_time(session, distance)\n\nif session_time < current_pb:\n    # New PB detected!\n    add_value(pb_history,\n              value={'distance': distance, 'seconds': session_time},\n              timestamp=session_date,\n              source='session_upload')\n"})}),"\n",(0,t.jsx)(s.h3,{id:"4-critical-speed-recalculation",children:"4. Critical Speed Recalculation"}),"\n",(0,t.jsx)(s.p,{children:"When PBs are updated, Critical Speed is automatically recalculated using the updated values at that point in time."}),"\n",(0,t.jsx)(s.h3,{id:"5-historical-upload-cascade",children:"5. Historical Upload Cascade"}),"\n",(0,t.jsx)(s.p,{children:"When a session older than 7 days is uploaded:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Detect historical upload (session_date < now - 7 days)\n        \u2193\nCheck if newer sessions exist\n        \u2193\nIf yes \u2192 Trigger cascade recalculation\n        \u2193\nReprocess all sessions after the historical date\n        \u2193\nEnsures statistics use updated PBs/CS\n"})}),"\n",(0,t.jsx)(s.h2,{id:"key-components",children:"Key Components"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Component"}),(0,t.jsx)(s.th,{children:"Responsibility"}),(0,t.jsx)(s.th,{children:"Location"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Time Series Utils"})}),(0,t.jsx)(s.td,{children:"Generic time series operations"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"app/utils/time_series.py"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Runner Service"})}),(0,t.jsx)(s.td,{children:"Update HR zones, PBs, CS"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"app/services/runner_service.py"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"File Processor"})}),(0,t.jsx)(s.td,{children:"Sequential session processing"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"app/file_processor.py"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Statistics Processor"})}),(0,t.jsx)(s.td,{children:"Period-aware calculations"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"app/statistics_processor.py"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"REST API"})}),(0,t.jsx)(s.td,{children:"Time series CRUD operations"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"app/routes.py"})})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"time-series-utility-functions",children:"Time Series Utility Functions"}),"\n",(0,t.jsxs)(s.p,{children:["Located in ",(0,t.jsx)(s.code,{children:"app/utils/time_series.py"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"get_value_at_date(time_series, date)"})})," - Binary search to find value active at specific date"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"get_latest_value(time_series)"})})," - Get most recent value"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"add_value(time_series, value, timestamp, source)"})})," - Add new entry, maintaining chronological order"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"get_value_history(time_series, start_date, end_date)"})})," - Query date range"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"rest-api-endpoints",children:"REST API Endpoints"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Endpoint"}),(0,t.jsx)(s.th,{children:"Method"}),(0,t.jsx)(s.th,{children:"Purpose"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/api/runners/<id>/heart-rate-zones"})}),(0,t.jsx)(s.td,{children:"GET"}),(0,t.jsx)(s.td,{children:"Get HR zones history"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/api/runners/<id>/heart-rate-zones"})}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:"Update HR zones"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/api/runners/<id>/personal-bests"})}),(0,t.jsx)(s.td,{children:"GET"}),(0,t.jsx)(s.td,{children:"Get PB history"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/api/runners/<id>/personal-bests"})}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:"Update PB"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/api/runners/<id>/critical-speed"})}),(0,t.jsx)(s.td,{children:"GET"}),(0,t.jsx)(s.td,{children:"Get CS history"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/api/runners/<id>/critical-speed"})}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:"Update CS"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"benefits-achieved",children:"Benefits Achieved"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Historical Preservation"})," - No data loss when values change"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Period-Appropriate Calculations"})," - Sessions use values valid at their date"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Automatic Maintenance"})," - PBs and CS update without manual intervention"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Chronological Consistency"})," - Upload order doesn't affect results"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Retroactive Corrections"})," - Historical uploads trigger necessary recalculations"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"migration",children:"Migration"}),"\n",(0,t.jsx)(s.p,{children:"Time series was implemented in three phases:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Migration 003"})," - Heart rate zones \u2192 time series"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Migration 004"})," - Personal bests \u2192 time series"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Migration 005"})," - Critical speed \u2192 time series"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"All existing data was preserved during migration. Legacy fields remain in the schema for backward compatibility."}),"\n",(0,t.jsxs)(s.p,{children:["For complete schema details, see ",(0,t.jsx)(s.a,{href:"/docs/storage/database-schema",children:"Database Schema"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);