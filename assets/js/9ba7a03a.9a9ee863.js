"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1465],{5450:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"architecture/data-flow","title":"Data Flow","description":"Session Upload Flow (Fully Asynchronous)","source":"@site/docs/architecture/data-flow.md","sourceDirName":"architecture","slug":"/architecture/data-flow","permalink":"/docs/architecture/data-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/architecture/data-flow.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Data Flow"},"sidebar":"tutorialSidebar","previous":{"title":"Components","permalink":"/docs/architecture/components"},"next":{"title":"Authentication","permalink":"/docs/architecture/authentication"}}');var r=s(4848),o=s(8453);const a={sidebar_position:3,title:"Data Flow"},i="Data Flow",l={},c=[{value:"Session Upload Flow (Fully Asynchronous)",id:"session-upload-flow-fully-asynchronous",level:2},{value:"Training Plan Generation Flow (Fully Asynchronous)",id:"training-plan-generation-flow-fully-asynchronous",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"data-flow",children:"Data Flow"})}),"\n",(0,r.jsx)(e.h2,{id:"session-upload-flow-fully-asynchronous",children:"Session Upload Flow (Fully Asynchronous)"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Overview"}),": All file processing happens in background jobs to provide instant user feedback and eliminate database contention."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'Frontend (Instant Response):\n1. User uploads FIT/ZIP file(s)\n   \u2193\n2. Flask receives multipart form data\n   \u2193\n3. Files saved to temporary location\n   \u2193\n4. Background job created and returned immediately (<1 second)\n   \u2193\n5. User sees: "\u2713 Files uploaded successfully. Processing in background..."\n\nBackground Processing (No Polling):\n6. JobManager spawns background thread\n   \u2193\n7. For each file:\n   \u251c\u2500\u2500 Extract ZIP files (if applicable)\n   \u251c\u2500\u2500 Find all FIT files recursively\n   \u251c\u2500\u2500 Check for duplicates\n   \u251c\u2500\u2500 Validate FIT format\n   \u251c\u2500\u2500 Convert FIT \u2192 Parquet\n   \u251c\u2500\u2500 Store in GridFS\n   \u2514\u2500\u2500 Save metadata to sessionsFIT/sessionsParquet\n   \u2193\n8. Statistics analysis job automatically queued\n   \u2193\n9. For each session:\n   \u251c\u2500\u2500 Calculate metrics (pace, HR zones, power, etc.)\n   \u251c\u2500\u2500 Store in sessionStatistics\n   \u251c\u2500\u2500 Check and update personal bests\n   \u2514\u2500\u2500 Recalculate critical speed if PBs improved\n   \u2193\n10. Runner history processor updates aggregated metrics\n   \u2193\n11. Background job banner disappears when complete\n   \u2193\n12. UI automatically shows new sessions (next page load)\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Key Features"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"No polling"}),': Frontend doesn\'t poll job status (eliminates "busy" database errors)']}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Instant feedback"}),": Upload completes in less than 1 second from user perspective"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Status visibility"}),": Background job banner shows processing status"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Automatic chaining"}),": File processing \u2192 Statistics analysis \u2192 History update"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Error resilience"}),": Individual file failures don't block other files"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"training-plan-generation-flow-fully-asynchronous",children:"Training Plan Generation Flow (Fully Asynchronous)"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Overview"}),": Training plan generation runs in background jobs to prevent UI blocking during CPU-intensive optimization."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Frontend (Instant Response):\n1. User requests plan generation\n   \u2193\n2. Flask creates background job and returns immediately\n   \u2193\n3. User sees: \"Training plan generation started! Check background jobs banner for status.\"\n   \u2193\n4. Background job banner appears (no polling)\n\nBackground Processing (No Polling):\n5. JobManager spawns background thread\n   \u2193\n6. TrainingPlanGenerator.generate_training_plan_async() spawns subprocess\n   \u2193\n7. generate_training_plan.py performs differential evolution optimization\n   \u2193\n8. Schema and workouts retrieved\n   \u2193\n9. Plan blocks populated with progressive overload calculated\n   \u2193\n10. Plan saved to trainingplan collection\n   \u2193\n11. Job status updated to 'completed'\n   \u2193\n12. Background job banner disappears when complete\n   \u2193\n13. User refreshes or navigates to see new plan\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Key Features"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"No polling"}),': Frontend doesn\'t poll job status (eliminates "busy" database errors)']}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Instant feedback"}),": Request completes in less than 1 second from user perspective"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Status visibility"}),": Background job banner shows processing status"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Subprocess isolation"}),": CPU-intensive optimization runs in separate process"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Matches session upload pattern"}),": Consistent UX across all async operations"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["For detailed algorithm explanation, see ",(0,r.jsx)(e.a,{href:"/docs/architecture/training-algorithm",children:"Training Algorithm"}),"."]})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>a,x:()=>i});var t=s(6540);const r={},o=t.createContext(r);function a(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);